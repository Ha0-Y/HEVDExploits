#pragma once

#include "utils.hpp"
#include <Windows.h>

#define SPRAY_NUM           0x4444

#define IOCTL_ALLOC         0x222013
#define IOCTL_USE           0x222017
#define IOCTL_FREE          0x22201B
#define IOCTL_ALLOC_FAKE    0x22201F



typedef struct _USE_AFTER_FREE_NON_PAGED_POOL 
{
    VOID *Callback;
    CHAR Buffer[0x54];
} USE_AFTER_FREE_NON_PAGED_POOL, * PUSE_AFTER_FREE_NON_PAGED_POOL;

typedef struct _PIPE_HANDLES 
{
    HANDLE read;
    HANDLE write;
} PIPE_HANDLES;

PIPE_HANDLES CreatePipeObject();

VOID SprayHeap();

VOID NonPagedPoolUafExploit();